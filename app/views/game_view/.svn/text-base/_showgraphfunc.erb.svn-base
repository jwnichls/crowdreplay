<script type="text/javascript">
function showGraph(vizData,max){
	try{
   g = new Dygraph(
       document.getElementById("graphdiv"),
       vizData,{
       	 labels:["time","volume"],
         valueRange: [0,max],
		 
		 clickCallback: function(e, x, pts) {
			
		 	var date = new Date(x);
					
			<%= remote_function(:update => "tweets", 
			                    :url => { :action => :tweets_at_time, :category => @category.category },
			                    :with => "'time=' + encodeURIComponent(date.toString())" ) %>
		 }
       }
   );
	}
	catch(ex)
	{
		alert(ex.toSource());
	}
}

function showInitialGraph(){
	var vizData = <% for vol_value in showgraphfunc -%>"<%=h vol_value.time %>,<%=h vol_value.count %>\n" +
                  <% end %>"";
	showGraph(vizData, <%= @max %>);
}

addEventListener("load",function() { showInitialGraph() }, true);
</script>
